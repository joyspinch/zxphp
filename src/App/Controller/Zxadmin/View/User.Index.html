<form class="layui-form layui-form-pane" lay-size="sm" lay-filter="<?php echo $__PRE__ ?>search_form">
    <div class="layui-row layui-col-space10">
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md2 layui-col-lg2">
            <input class="layui-input" name="username" placeholder="用户名" autocomplete="off">
        </div>
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md2 layui-col-lg2">
            <input class="layui-input" name="mobile" placeholder="手机号" autocomplete="off">
        </div>
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md2 layui-col-lg2">
            <select class="layui-input" id="<?php echo $__PRE__ ?>search_gid" name="gid" placeholder="权限组"
                    autocomplete="off">
                <option value="">请选择权限组</option>
                <?php foreach ($role_kv as $k => $v) { ?>
                    <option value="<?php echo $k ?>"><?php echo $v ?></option>
                <?php } ?>
            </select>
        </div>
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md3 layui-col-lg2">
            <div class="layui-btn-group">
                <button type="button" class="layui-btn" lay-submit lay-filter="<?php echo $__PRE__ ?>search_submit">搜索
                </button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md2 layui-col-lg1">
            <div class="layui-btn-group">
                <button type="button" id="<?php echo $__PRE__ ?>add" class="layui-btn layui-btn-normal">添加账户</button>
            </div>
        </div>
    </div>
</form>

<div class="layui-clear"></div>
<div style="margin-top:10px">
    <table class="layui-hide" id="<?php echo $__PRE__ ?>table" lay-filter="<?php echo $__PRE__ ?>table"></table>
</div>

<script type="text/html" id="<?php echo $__PRE__ ?>bar">
    <div class="layui-btn-group">
        <a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="detail">详情</a>
    </div>
</script>
<script type="text/html" id="<?php echo $__PRE__ ?>add_form_tpl">
    <form style="padding:5px;" class="layui-form" action="../../<?=$__DIR__?>/user/index">
        <div class="layui-form-item">
            <label class="layui-form-label">登录账户</label>
            <div class="layui-input-inline">
                <input type="text" name="username" required lay-verify="required" placeholder="请输入登录账户" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">登录密码</label>
            <div class="layui-input-inline">
                <input type="text" name="password_new" required lay-verify="required" placeholder="请输入登录密码"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">用户组</label>
            <div class="layui-input-inline">
                <select name="gid" class="layui-select">
                    <option value="">请选择用户组</option>
                    <?php foreach ($role_kv as $k => $v) { ?>
                        <option value="<?php echo $k ?>"><?php echo $v ?></option>
                    <?php } ?>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">QQ号码</label>
            <div class="layui-input-inline">
                <input type="text" name="qq" placeholder="请输入QQ号码" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="add">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</script>

<script type="text/html" id="<?php echo $__PRE__ ?>edit_form_tpl">
    <div class="layui-tab layui-tab-brief" lay-filter="<?php echo $__PRE__ ?>form_edit_bar">
        <ul class="layui-tab-title">
            <li class="layui-this">用户编辑</li>

        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <form class="layui-form" action="../../<?=$__DIR__?>/user/index" lay-filter="<?php echo $__PRE__ ?>_edit_form">
                    <div class="layui-row">
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                            <div class="layui-form-item">
                                <label class="layui-form-label">登录账户</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="username" readonly disabled placeholder="请输入登录账户"
                                           autocomplete="off" class="layui-input">
                                    <input type="hidden" name="uid" required lay-verify="required" placeholder="请输入登录账户"
                                           autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">登陆密码</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="password_new" placeholder="请输入密码,不修改请留空" autocomplete="off"
                                           class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">QQ号码</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="qq" placeholder="请输入QQ号码" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">积分</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="credits" readonly class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">金币</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="golds" readonly class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">软妹币</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="rmbs" readonly class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                            <div class="layui-form-item">
                                <label class="layui-form-label">用户组</label>
                                <div class="layui-input-inline">
                                    <select name="gid" class="layui-input">
                                        <option value="">请选择用户组</option>
                                        <?php foreach ($role_kv as $k => $v) { ?>
                                            <option value="<?php echo $k ?>"><?php echo $v ?></option>
                                        <?php } ?>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="*">保存信息</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>

</script>

<script>

    $('#<?php echo $__PRE__?>add').click(function (e) {
        layer.open({
            type: 1,
            title: "添加账户",
            area: ['550px', '450px'],
            content: $('#<?php echo $__PRE__?>add_form_tpl').html(),
            success: function () {
                form.render();
            }
        });
    })

    var <?php echo $__PRE__?>table = table.render({
        elem: '#<?php echo $__PRE__?>table'
        , url: '../../<?=$__DIR__?>/user/index'
        , skin: 'line'
		, page: true
        , height: 'full-220'
        , limits: [10, 15, 20, 50, 100, 200]
        , totalRow: true
        , cols: [[
             {field: 'uid', title: 'ID', width: 70, unresize: true, sort: true}
            , {field: 'username', title: '用户名', width: 120, totalRowText: '合计'}
            , {field: 'role_name', title: '用户组', width: 90}
            , {field: 'credits', title: '积分', width: 80, totalRow: true, sort: true}
            , {field: 'golds', title: '金币', width: 80, totalRow: true, sort: true}
            , {field: 'rmbs', title: '软妹币', width: 80, totalRow: true, sort: true}
            , {
                field: 'status', title: '状态', width: 80, templet: function (d) {
                    return " <input type=\"checkbox\" name=\"status\" value=\"" + d.uid + "\" lay-skin=\"switch\" lay-text=\"启用|禁用\" lay-filter=\"<?php echo $__PRE__?>status\" " + (d.status == 1 ? 'checked' : '') + ">"
                }
            }
            , {field: 'do', title: '操作', width: 100, toolbar: "#<?php echo $__PRE__?>bar"}
        ]]
        , response: {
            statusCode: "0000"
        }
        , parseData: function (res) {
            return {
                "code": res.resp_code,
                "msg": res.msg,
                "count": res.total,
                "data": res.results
            };
        }
    });

    form.on('switch(<?php echo $__PRE__?>status)', function (obj) {
        $.xpost('../../<?=$__DIR__?>/user/field', {
            id: obj.value,
            field: "status",
            value: obj.elem.checked == true ? 1 : 0
        }, function (e) {
            if (e.resp_code == '0000') {
                layer.tips(e.msg, obj.othis, {tips: [4, '#393D49']});
            } else {
                if (obj.elem.checked == true) {
                    obj.elem.checked = false
                    $(obj.othis).removeClass("layui-form-onswitch").find('em').text('禁用');
                } else {
                    obj.elem.checked = true
                    $(obj.othis).addClass("layui-form-onswitch").find('em').text('启用');
                }
            }
        });
    });

    table.on('edit(<?php echo $__PRE__?>table)', function (obj) {
        $.xpost('../../<?=$__DIR__?>/user/field', {id: obj.data.id, field: obj.field, value: obj.value}, function (d) {
            layer.msg(d.msg);
        })
    });

    table.on('sort(<?php echo $__PRE__?>table)', function (obj) {
        <?php echo $__PRE__?>table.reload({
            initSort: obj
            , where: {
                field: obj.field
                , order: obj.type
            }
        });
    });

    table.on('tool(<?php echo $__PRE__?>table)', function (obj) {
        var data = obj.data;
        var layEvent = obj.event;
        var tr = obj.tr;

        if (layEvent === 'detail') { //查看
            layer.open({
                type: 1,
                title: "用户详情",
                area: ['760px', '600px'],
                content: $('#<?php echo $__PRE__?>edit_form_tpl').html(),
                success: function (d) {
                    form.val("<?php echo $__PRE__?>_edit_form", data);
                }
            });
        }
    })
    form.on('submit(<?php echo $__PRE__?>search_submit)', function (data) {
        <?php echo $__PRE__?>table.reload({
            where: data.field
        });
        return false;
    });
    form.render();
</script>
